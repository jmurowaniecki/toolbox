#!/bin/bash

STD_FOLDER='/var/www/preview/'
STD_PASSWORD='access4guest!'
STD_GROUP='clients'

project=${1}
username=${2:-"${project}"}
password=${3:-"${STD_PASSWORD}"}
directory="${STD_FOLDER}${project}"

declare -A lang
lang[welcome_text_htaccess]="Project ${project}"

encrypted_password=`openssl passwd -1 ${password}`
useradd -m -s /bin/false -p "${encrypted_password}" "${username}" -d "${directory}"
adduser "${username}" "${STD_GROUP}"
smbpasswd -a "${username}" -w "${password}"
htpasswd -bcmd "${directory}/.htpasswd" "${username}" "${password}"
echo "# automatically generated by toolbox - https://github.com/jmurowaniecki/toolbox
AuthName \"${lang[welcome_text_htaccess]}\"
AuthType Basic
AuthUserFile ${directory}/.htpasswd
require valid-user" > "${directory}/.htaccess"
